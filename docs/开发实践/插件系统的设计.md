# 插件系统的设计

## SDK 设计

```ts
export default class SDK {
  protected plugins: Plugin[] = [];

  public use(plugins: Plugin | Plugin[]) {
    const pluginArray = Array.isArray(plugins) ? plugins : [plugins];
    pluginArray.forEach((plugin) => {
      if (this.plugins.includes(plugin)) return;

      if (plugin.use) {
        plugin.use.forEach((dep) => this.use(dep));
      }

      this.plugins.push(plugin);
    });
  }

  public report(params) {
    // report 核心逻辑
    // ...

    // 插件逻辑
    for (const plugin of this.plugins) {
      try {
        plugin.onReport?.(params);
      } catch (e) {
        console.error(e);
      }
    }
  }
}
```

## SDK 使用

```ts
import { sdk } from "@sdk";

sdk.use({
  onReport(params) {
    // 上报逻辑
    console.log(params);
  },
});
```
