# 构建配置

## 常见问题

### Q：为什么在构建配置文件里，`require('some-plugin')()` 最好写在代码的执行部分，而不是放在导入部分，是因为有副作用吗？

是的，`require('some-plugin')()` 一般放在代码执行部分是因为它可能会引入副作用。这种做法确保插件在特定的上下文中被正确执行，从而避免在导入阶段就触发不必要的行为。

#### 1. 副作用的概念

在编程中，副作用是指函数在执行时除了返回值外，还会影响外部状态或环境的行为。比如：

- 修改全局变量
- 读取或写入文件
- 发送网络请求

当你在模块导入阶段执行某些代码时，这些副作用可能会在不合适的时机被触发，导致意想不到的行为。

#### 2. 模块加载的时序

JavaScript 的模块加载是同步的，当你使用 require 导入一个模块时，它会立即执行该模块的顶层代码。如果你把 `require('some-plugin')()` 放在导入部分，那么这个插件的执行将会在模块加载时立刻发生。

#### 3. 执行时机

将 `require('some-plugin')()` 放在代码的执行部分，可以让你控制何时实际执行这个插件。通常来说，这样做的好处包括：

- 依赖准备：确保在执行插件之前，其他必要的依赖和上下文已经准备好。
- 减少副作用的影响：避免在模块加载时就执行可能影响其他代码的操作，比如修改配置、注册全局状态等。
- 条件执行：有时候你可能只想在特定条件下执行插件，这样就可以灵活地控制它的执行时机。

#### 4. 实践中的例子

比如在构建工具（如 Webpack 或 Babel）的配置中，某些插件可能会在执行阶段进行特定的操作（例如，修改 AST）。如果你在导入阶段就执行了这些插件，可能会影响其他插件的行为或导致构建失败。

#### 5. 总结

总之，把 `require('some-plugin')()` 放在代码的执行部分是为了确保它在适当的上下文中运行，避免不必要的副作用。这样可以提高代码的可维护性和稳定性。
